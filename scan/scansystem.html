<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ...其他头部内容保持不变... -->
</head>
<body>
    <!-- ...页面内容保持不变... -->

    <script>
        $(document).ready(function () {
            const html5QrCode = new Html5Qrcode("qr-reader"); // 初始化二维码扫描器

            function queryBook(barcode) {
                $.ajax({
                    url: "/query",
                    method: "GET",
                    data: { barcode: barcode },
                    success: function (data) {
                        if (data) {
                            $("#resultsContainer").html(`
                                <div><strong>条码号：</strong> ${data.barcode}</div>
                                <div><strong>书名：</strong> ${data.title}</div>
                                <div><strong>位置：</strong> ${data.location}</div>
                            `);
                        } else {
                            $("#resultsContainer").html("未找到条码号：" + barcode);
                        }
                    },
                    error: function () {
                        alert("查询失败，请检查网络或后端服务！");
                    },
                });
            }

            $("#barcodeInput").on("input", function () {
                const barcode = $(this).val().trim();
                if (barcode.length === 7) {
                    queryBook(barcode);
                }
            });

            $('#scanBtn').on('click', function () {
                html5QrCode.start(
                    { facingMode: "environment" },
                    { fps: 10, qrbox: 250 },
                    function(decodedText, decodedResult) {
                        queryBook(decodedText);
                    },
                    function(error) {
                        console.warn(`扫描失败: ${error}`);
                    }
                ).catch((err) => {
                    console.error(`初始化扫描器失败: ${err}`);
                });
            });
        });
    </script>
</body>
</html>