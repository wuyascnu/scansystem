<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>铁铮图书馆图书分类管理</title>
    <!-- 引入 Bootstrap 样式和 Bootstrap Table 插件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.21.3/dist/bootstrap-table.min.css">
</head>
<body>
    <div class="container mt-4">
        <h3 class="text-center">铁铮图书馆图书分类管理系统</h3>

        <!-- 操作按钮 -->
        <div class="d-flex justify-content-end mb-2">
            <button class="btn btn-success me-2" id="addBtn">新增</button>
            <button class="btn btn-primary" id="saveBtn">保存修改</button>
        </div>

        <!-- Bootstrap Table -->
        <table id="table" 
               data-toggle="table" 
               data-search="true" 
               data-pagination="true" 
               data-toolbar="#toolbar"
               data-url="https://tiezheng.natapp4.cc/api/library-classification">
            <thead>
                <tr>
                    <th data-field="classification_id" data-visible="false">分类ID</th>
                    <th data-field="classification_name" data-editable="true">分类名称</th>
                    <th data-field="classification_letter" data-editable="true">中图法分类字母</th>
                    <th data-field="classification_description" data-editable="true">中图法分类名称</th>
                    <th data-field="shelf_number" data-editable="true">书架号</th>
                    <th data-field="actions" data-formatter="actionFormatter" data-events="window.operateEvents">操作</th>
                </tr>
            </thead>
        </table>
    </div>

    <!-- 引入依赖的脚本 -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.21.3/dist/bootstrap-table.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.21.3/dist/extensions/editable/bootstrap-table-editable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.21.3/dist/extensions/toolbar/bootstrap-table-toolbar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap3-editable@1.5.1/js/bootstrap-editable.min.js"></script>

    <script>
        // 初始化 Bootstrap Table
        $(document).ready(function () {
            const $table = $('#table');

            // 格式化操作列
            window.operateEvents = {
                'click .delete': function (e, value, row, index) {
                    if (confirm('确定要删除这条记录吗？')) {
                        // 发送删除请求
                        fetch(`https://tiezheng.natapp4.cc/api/library-classification/${row.classification_id}`, {
                            method: 'DELETE',
                        }).then(() => {
                            alert('删除成功');
                            $table.bootstrapTable('refresh'); // 刷新表格
                        });
                    }
                }
            };

            function actionFormatter(value, row, index) {
                return [
                    '<button class="btn btn-danger btn-sm delete">删除</button>'
                ].join('');
            }

            // 新增按钮点击事件
            $('#addBtn').click(function () {
                $table.bootstrapTable('append', {
                    classification_id: null,
                    classification_name: '',
                    classification_letter: '',
                    classification_description: '',
                    shelf_number: ''
                });
            });

            // 保存修改按钮点击事件
            $('#saveBtn').click(function () {
                const data = $table.bootstrapTable('getData'); // 获取表格数据
                fetch('https://tiezheng.natapp4.cc/api/library-classification', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                }).then(response => {
                    if (response.ok) {
                        alert('保存成功');
                        $table.bootstrapTable('refresh');
                    } else {
                        alert('保存失败');
                    }
                });
            });
        });
    </script>
</body>
</html>
