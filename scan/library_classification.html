<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>铁铮图书馆图书分类管理</title>
    <!-- 引入 Bootstrap 样式和 Bootstrap Table 插件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.21.3/dist/bootstrap-table.min.css">
</head>
<body>
    <div class="container mt-4">
        <h3 class="text-center">铁铮图书馆图书分类管理系统</h3>

        <!-- 操作按钮 -->
        <div class="d-flex justify-content-end mb-2">
            <button class="btn btn-success me-2" id="addBtn">新增</button>
        </div>

        <!-- Bootstrap Table -->
        <table id="table" 
               data-toggle="table" 
               data-search="true" 
               data-pagination="true" 
               data-toolbar="#toolbar"
               data-url="https://tiezheng.natapp4.cc/api/library-classification">
            <thead>
                <tr>
                    <th data-field="classification_id" data-visible="false">分类ID</th>
                    <th data-field="classification_name" data-editable="true">分类名称</th>
                    <th data-field="classification_letter" data-editable="true">中图法分类字母</th>
                    <th data-field="classification_description" data-editable="true">中图法分类名称</th>
                    <th data-field="shelf_number" data-editable="true">书架号</th>
                    <th data-field="actions" data-formatter="actionFormatter" data-events="window.operateEvents">操作</th>
                </tr>
            </thead>
        </table>
    </div>

    <!-- 引入依赖的脚本 -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.21.3/dist/bootstrap-table.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.21.3/dist/extensions/editable/bootstrap-table-editable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap3-editable@1.5.1/js/bootstrap-editable.min.js"></script>

    <script>
        // 全局定义操作事件
        window.operateEvents = {
            // 删除按钮
            'click .delete': function (e, value, row, index) {
                if (confirm('确定要删除这条记录吗？')) {
                    fetch(`https://tiezheng.natapp4.cc/api/library-classification/${row.classification_id}`, {
                        method: 'DELETE',
                    }).then(response => {
                        if (response.ok) {
                            alert('删除成功');
                            $('#table').bootstrapTable('refresh'); // 刷新表格
                        } else {
                            alert('删除失败，请重试');
                        }
                    });
                }
            },
            // 修改按钮
            'click .edit': function (e, value, row, index) {
                const updatedRow = {
                    ...row,
                    classification_name: prompt("修改分类名称:", row.classification_name) || row.classification_name,
                    classification_letter: prompt("修改分类字母:", row.classification_letter) || row.classification_letter,
                    classification_description: prompt("修改分类名称:", row.classification_description) || row.classification_description,
                    shelf_number: prompt("修改书架号:", row.shelf_number) || row.shelf_number
                };

                fetch(`https://tiezheng.natapp4.cc/api/library-classification/${row.classification_id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedRow)
                }).then(response => {
                    if (response.ok) {
                        alert('修改成功');
                        $('#table').bootstrapTable('refresh');
                    } else {
                        alert('修改失败，请重试');
                    }
                });
            }
        };

        // 格式化操作列
        function actionFormatter(value, row, index) {
            return [
                '<button class="btn btn-primary btn-sm edit me-2">修改</button>',
                '<button class="btn btn-danger btn-sm delete">删除</button>'
            ].join('');
        }

        $(document).ready(function () {
            const $table = $('#table');

            // 新增按钮点击事件
            $('#addBtn').click(function () {
                const newRow = {
                    classification_id: null,
                    classification_name: prompt("输入分类名称:") || '',
                    classification_letter: prompt("输入分类字母:") || '',
                    classification_description: prompt("输入中图法分类名称:") || '',
                    shelf_number: prompt("输入书架号:") || ''
                };

                fetch('https://tiezheng.natapp4.cc/api/library-classification', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newRow)
                }).then(response => {
                    if (response.ok) {
                        alert('新增成功');
                        $table.bootstrapTable('refresh');
                    } else {
                        alert('新增失败，请重试');
                    }
                });
            });
        });
    </script>
</body>
</html>
